<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Graphics hardware autoconfiguration &mdash; helloSystem  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Binary Compatibility" href="binary-compatibility.html" />
    <link rel="prev" title="geom_rowr kernel module" href="geom_rowr.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            helloSystem
              <img src="../_static/hello_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/getting-started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/components.html">Getting to know the system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/feedback.html">Providing feedback</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reviewer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reviewer/guide.html">Reviewer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ux-guidelines.html">User Experience Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="boot.html">Boot process</a></li>
<li class="toctree-l1"><a class="reference internal" href="geom_rowr.html">geom_rowr kernel module</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Graphics hardware autoconfiguration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#theory-of-operation">Theory of operation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#disabling-the-graphics-driver-menu">Disabling the graphics driver menu</a></li>
<li class="toctree-l2"><a class="reference internal" href="#disabling-the-automatic-graphics-driver-setup">Disabling the automatic graphics driver setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#nvidia-drivers">Nvidia drivers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="binary-compatibility.html">Binary Compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="application-bundles.html">Application Bundles</a></li>
<li class="toctree-l1"><a class="reference internal" href="menu.html">Global Menu</a></li>
<li class="toctree-l1"><a class="reference internal" href="filer-context-menus.html">Extending Filer context menus</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer-tools.html">Developer Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="midi.html">MIDI</a></li>
<li class="toctree-l1"><a class="reference internal" href="specifications.html">Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="building.html">Building the Live ISO</a></li>
<li class="toctree-l1"><a class="reference internal" href="monkey-patch.html">Monkey Patching</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracing.html">Tracing with DTrace/dtruss</a></li>
<li class="toctree-l1"><a class="reference internal" href="localization.html">Localization</a></li>
<li class="toctree-l1"><a class="reference internal" href="ports.html">Working with FreeBSD Ports</a></li>
<li class="toctree-l1"><a class="reference internal" href="base.html">Working with the FreeBSD base system</a></li>
<li class="toctree-l1"><a class="reference internal" href="man.html">Writing man pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="rpi.html">Raspberry Pi</a></li>
<li class="toctree-l1"><a class="reference internal" href="linux.html">Building on Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributions.html">Note to distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">helloSystem</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Graphics hardware autoconfiguration</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/helloSystem/docs/blob/main/developer/graphics.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="graphics-hardware-autoconfiguration">
<h1>Graphics hardware autoconfiguration<a class="headerlink" href="#graphics-hardware-autoconfiguration" title="Permalink to this heading"></a></h1>
<p>helloSystem uses <code class="docutils literal notranslate"><span class="pre">initgfx</span></code> for the automatic configuration of the graphics hardware in your computer.</p>
<div class="section" id="theory-of-operation">
<h2>Theory of operation<a class="headerlink" href="#theory-of-operation" title="Permalink to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">initgfx</span></code> consists of the following files and directories:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>/etc/rc.d/initgfx
/etc/initgfx_device.db
/etc/initgfx_xorg.cfg
/usr/local/nvidia/&lt;version&gt;/&lt;contents of the driver tgz&gt;
/usr/local/etc/X11/xorg.conf.d/&lt;dynamically generated&gt; # defined by path_xorg_cfg_dir
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">initgfx</span></code> calculates a config ID which is a MD5 checksum of the output of <code class="docutils literal notranslate"><span class="pre">sysctl</span> <span class="pre">dev.vgapci</span> <span class="pre">|</span> <span class="pre">sort</span></code>. If the file <code class="docutils literal notranslate"><span class="pre">/var/initgfx_config.id</span></code> exists, check if
its content matches the config ID. If that is the case, load the modules
set via the <code class="docutils literal notranslate"><span class="pre">rc.conf</span></code> variable <code class="docutils literal notranslate"><span class="pre">initgfx_kmods</span></code>, and exit. If the file
<code class="docutils literal notranslate"><span class="pre">/var/initgfx_config.id</span></code> does not exist, or its content does not match the
config ID, try to auto-detect the accelerated graphics driver. Use <code class="docutils literal notranslate"><span class="pre">xinit</span></code>
to test if the X server starts, change <code class="docutils literal notranslate"><span class="pre">initgfx_kmods</span></code>, write a new xorg
config file, and save the new config ID if the test was successful.
Otherwise, as a fallback, write a xorg config file for the VESA or SCFB
driver depending on whether the system was booted via BIOS or EFI.</p>
<p><a class="reference external" href="https://github.com/nomadbsd/NomadBSD/commit/a346f134aaca1cdc164346f63808abdb4d8919e3">Source</a></p>
<p>If everything goes well, then after running <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">sysctl</span> <span class="pre">initgfx</span> <span class="pre">start</span></code> you should have (example: Nvidia):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cat<span class="w"> </span>/usr/local/etc/X11/xorg.conf.d/00-video-initgfx.conf<span class="w"> </span>
<span class="go">Section &quot;Device&quot;</span>
<span class="go">    Identifier    &quot;NVIDIA CARD&quot;</span>
<span class="go">    VendorName    &quot;NVIDIA Corporation&quot;</span>
<span class="go">    Driver        &quot;nvidia&quot;</span>
<span class="go">    BusID         &quot;PCI:1:0:0&quot;</span>
<span class="go">EndSection</span>
</pre></div>
</div>
</div>
<div class="section" id="disabling-the-graphics-driver-menu">
<h2>Disabling the graphics driver menu<a class="headerlink" href="#disabling-the-graphics-driver-menu" title="Permalink to this heading"></a></h2>
<p>If you want to disable the graphics driver menu, add</p>
<p><code class="docutils literal notranslate"><span class="pre">initgfx_menu=&quot;NO&quot;</span></code> to <code class="docutils literal notranslate"><span class="pre">/etc/rc.conf</span></code>.</p>
<p>By default, initgfx will try autodetection, but you can instead define a default driver to use by setting <code class="docutils literal notranslate"><span class="pre">initgfx_default</span></code> to <code class="docutils literal notranslate"><span class="pre">scfb</span></code> or <code class="docutils literal notranslate"><span class="pre">vesa</span></code> in <code class="docutils literal notranslate"><span class="pre">/etc/rc.conf</span></code>.</p>
</div>
<div class="section" id="disabling-the-automatic-graphics-driver-setup">
<h2>Disabling the automatic graphics driver setup<a class="headerlink" href="#disabling-the-automatic-graphics-driver-setup" title="Permalink to this heading"></a></h2>
<p>If you want to create your own graphics driver settings, you can disable initgfx by adding</p>
<p><code class="docutils literal notranslate"><span class="pre">initgfx_enable=&quot;NO&quot;</span></code> to <code class="docutils literal notranslate"><span class="pre">/etc/rc.conf</span></code>.</p>
<p>If you would like to temporarily disable the automatic graphics driver setup and use a failsafe non-accelerated driver (VESA or SCFB), then enter <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">initgfx.detect.disable=1</span></code> followed by <code class="docutils literal notranslate"><span class="pre">boot</span></code> at the bootloader prompt. This can be useful e.g., in cases where the automatically detected graphics driver does not work properly on the Live system.</p>
</div>
<div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this heading"></a></h2>
<p>If applications that are using OpenGL crash on Nvidia systems, then it may be that the Nvidia driver was correctly loaded but the wrong Xorg configuration has been loaded, not actually using the Nvidia driver. This can happen when initgfx writes the dynamically generated Xorg configuration to <code class="docutils literal notranslate"><span class="pre">path_xorg_cfg_dir</span></code> (which points to <code class="docutils literal notranslate"><span class="pre">/usr/local/etc/X11/xorg.conf.d/</span></code> by default) but other files have been placed by other packages or the user into, e.g., <code class="docutils literal notranslate"><span class="pre">/etc/X11/xorg.conf.d</span></code>. You can verify which Xorg configuration directory was used by Xorg with <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/var/log/Xorg.0.log</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">Using.config</span></code>. Seemingly Xorg cannot combine configuration stored in multiple <code class="docutils literal notranslate"><span class="pre">xorg.conf.d</span></code> directories.</p>
</div>
<div class="section" id="nvidia-drivers">
<h2>Nvidia drivers<a class="headerlink" href="#nvidia-drivers" title="Permalink to this heading"></a></h2>
<p>Different versions of the Nvidia drivers exist. Unfortunately the latest version does not support all the earlier GPUs, so multiple versions of the Nvidia drivers are shipped with helloSystem to cover both new and older Nvidia GPUs. <code class="docutils literal notranslate"><span class="pre">initgfx</span></code> should automatically select a version suitable for the hardware in the computer.</p>
<p>To check this:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cat<span class="w"> </span>/etc/rc.conf<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>initgfx_kmods
<span class="go">initgfx_kmods=&quot;/usr/local/nvidia/390/boot/modules/nvidia.ko /usr/local/nvidia/390/boot/modules/nvidia-modeset.ko&quot;</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="geom_rowr.html" class="btn btn-neutral float-left" title="geom_rowr kernel module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="binary-compatibility.html" class="btn btn-neutral float-right" title="Binary Compatibility" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>